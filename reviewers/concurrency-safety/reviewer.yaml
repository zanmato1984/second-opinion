id: concurrency-safety
type: domain
owners: ["review-bot"]
display_name: "Concurrency Safety"
description: "Concurrency hazards, lock ordering, and thread safety risks."

scopes:
  repos: ["pingcap/tidb", "pingcap/tiflash"]
  paths_include: ["**/*.cc", "**/*.cpp", "**/*.h", "**/*.hpp", "**/*.rs"]

tags:
  - lang:cpp
  - risk:correctness
  - scenario:upgrade
  - maturity:experimental

rules:
  - id: SO-CONC-001
    severity: high
    message: "Two mutex locks are added back-to-back; verify lock ordering to avoid deadlock."
    suggestion: "Prefer std::scoped_lock or enforce a single global lock ordering."
    pattern: '\block\s*\([^\n]*\)[^\n]*\n\s*.*\block\s*\('
    confidence: 0.6
